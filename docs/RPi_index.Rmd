---
title: "RPi A-Z Setup and Projects"
author: "JAT"
date: "Updated on: `r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    css: styles.css
    toc: true
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE} 
a = knitr::asis_output("\U2714")
```


```{r klippy, echo=FALSE, include=TRUE}
#It allows the clipboard button to be available in the html output
klippy::klippy()

#install.packages("remotes")
#remotes::install_github("rlesur/klippy")
```



# **RPi Setup**



The Raspberry Pi is a tiny and affordable computer, low power consumption (ARM based) that you can use to learn programming through fun, practical projects and also allow us to have our own server to run 24/7 tasks that don't require the expensive hardware of a PC. [^1]

It can run Linux distributions like: Debian, OpenMediaVault or most commonly Raspbian OS.


All of the services/projects that we can make the RPi to run, can be easily ported to some cloud service, VPS and so on. So it serves as an entry point to learn also about that as well.

Due to the compatibility between raspbian and most debian based linux, most of the topic here will reference the guide on how to setup a general linux server, including an extra explanation here where some specifics apply to the RPi.

As of today, the total compatibility with linux would be on the following topics:

- [ ] RPi Firmware update
- [ ] Not all Docker images are ARM compatible, check in the tags
- [x] Schedule Crontab tasks
- [x] Setup fail2ban
- [x] Firewall setup (UFW)
- [x] Create custom aliases
- [x] Install GIT and sync your repositories

With Docker containers, due to the nature of the ARM processors that the RPi includes, we might need as well some changes from an usual .yml configuration for X86 processors. When pulling the images, docker will find the one that suits your machine (if no specific version is specified)


Web version of the outputs generated by the codes posted on <`r web_repo`/RPi>


Please feel free to copy, modify, distribute and suggest any further improvements on the codes below. [^2]


## RPi Firmware update

Check firmware version with :

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
  sudo rpi-eeprom-update
```
   
Option 1:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo apt update &&
sudo apt full-upgrade

```


Now restart Raspberry Pi by using:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo shutdown - r now
```
 
Option 2:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"} 
sudo apt update && sudo apt upgrade -y \
sudo apt install rpi-eeprom rpi-eeprom-images
```    
Install rpi-eeprom:
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"} 
sudo apt install rpi-eeprom rpi-eeprom-images
```


Update the Firmware: 
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"} 
sudo rpi-eeprom-update -a
```

Check the linux kernel version:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"} 
hostnamectl
```

##### **Last time tested on `format(Sys.time(), '%b %Y')` `r a`**



## Schedule Crontab tasks


As we can expect, crontab is a common function on linux, so we can use [this guide](`r web_hosted`/Linux/#Schedule_Crontab_tasks) to make it run on our RPi.


## Setup fail2ban
 
 To setup fail2ban in the RPi, we simply have to follow the same steps as in any other [Linux distro](`r web_hosted`/Linux/#Setup_fail2ban).
 
 It is extremely recommendable to do it, specially if we are going to open any of our services to the internet, like hosting a web page with with wordpress or opening services to the internet
 
 
## Firewall setup (UFW)
 
Another important security measure is to correctly setup our firewall.

Be sure to leave open only the ports that your services need and again, we can follow the same process as in the [guide for linux](`r web_hosted`/Linux/#Firewall_setup_(ufw)).

## Create custom aliases 
 
Lets edit this file:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
nano ~/.bash_aliases
```

Add this line to know the RPi's temperature by typing 'temp' on the terminal:
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
alias temp='/opt/vc/bin/vcgencmd measure_temp' ### TEMP RPi
```

Use this command to be able to use the new alias already in the current session
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
source ~/.bashrc
```

Other aliases that can be used indistinctely in any other linux distro, can be found [here](`r web_hosted`/Linux/#Create_custom_aliases)

##### **Last time tested on Sept 2021 `r a`**

## Install GIT and sync your repos
 

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}

 sudo apt install git && sudo mkdir GITHUB_SYNC && cd GITHUB_SYNC &&
 git clone https://github.com/jalcocert/RPi.git && git pull #to make sure its up to date (a cron task could be scheduled)

# 0 0 * * * cd ~/GITHUB_SYNC/RPi && git pull #example cron task
```

```{r, include=FALSE, eval=FALSE, class.source=".TheCode"}

 cd GITHUB_SYNC &&
 git clone https://github.com/jalcocert/Linux.git && git pull
 git clone https://github.com/jalcocert/Financial_analysis_R.git && git pull
 git clone https://github.com/jalcocert/MultiBodySystemDynamics-MBSD-.git && git pull
```

##### **Last time tested on Sept 2021 `r a`**



# **RPi Networking**


## RaspAP

Make your RPi work as a router that you can trust on your trips while connecting to unknown networks:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
 sudo apt-get update
 sudo apt-get full-upgrade
 sudo reboot
 
 sudo raspi-config
 
curl -sL https://install.raspap.com | bash
```

Following a reboot, the wireless AP network will be configured as follows:
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
IP address: 10.3.141.1
Username: admin 
Password: secret
DHCP range: 10.3.141.50 â€” 10.3.141.255
SSID: raspi-webgui
Password: ChangeMe
```

## TailScale VPN setup

Since raspberry OS is another linux distribution (Debian based), the Tailscale installation listed in the following github page:
<`web_hosted`/Linux/#Tailscale> are completely functional on the RPi as it would be, for example in Ubuntu.

##### **Last time tested on Sept 2021 `r a`**

# **RPi Self-Hosting**


## Prerequisites

Self - hosting can be simplified with Docker, thanks to the great work of the community that bundles a lot of services into docker images and make them available with their code.

To install docker in the RPI, we need a different installation since their processors are ARM:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo apt-get update && sudo apt-get upgrade && curl -fsSL https://get.docker.com -o get-docker.sh
```

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo sh get-docker.sh && docker version

#Test that docker works with this image:
#sudo docker run hello-world
```

## Your Cloud

#### Install Nextcloud

To install nextcloud in RPi, we need to include MariaDB in the installation (it supports ARM processors, not like mysql)

```{r, include=FALSE, eval=FALSE, class.source=".TheCode"}

sudo chmod rwx /media/pi/ELEMENTARY/nextcloud_data
sudo chmod -R 777 /media/pi/ELEMENTARY/nextcloud_data

 sudo docker run -d -p 8080:80 --name nextcloud --restart unless-stopped \
-v /media/pi/ELEMENTARY/nextcloud_data/nextcloud:/var/www/html \
-v /media/pi/ELEMENTARY/nextcloud_data/apps:/var/www/html/custom_apps \
-v /media/pi/ELEMENTARY/nextcloud_data/config:/var/www/html/config \
-v /media/pi/ELEMENTARY/nextcloud_data/data:/var/www/html/data \
-v /media/pi/ELEMENTARY/nextcloud_data/theme:/var/www/html/themes nextcloud 

```


In linux systems it is as simple as running the following commands in the terminal after having installed docker:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo docker run -d -v ~/nextcloud:/var/www/html -p 8080:80 --name nextcloud_container nextcloud 

```

Remember to update the list of trusted domains so that other devices can log, we can see the current list with:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo docker exec --user www-data nextcloud_container php occ config:system:get trusted_domains
```

To add a new domain/ internal ip, simply:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo docker exec --user www-data nextcloud_container php occ config:system:set trusted_domains 7 --value 192.168.1.30:8080

```

You can check your device internal IP adress with:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
hostname -I
```

To access nextcloud while being out of home, simply configure your VPN, for example with tailscale, and add the internal Ip address assign by tail scale as shown two commands before.

As this would fall under general linux systems, the guide sits on: <https://jalcocert.github.io/Linux/#Tailscale>





Also, a review on external drives file system is beneficial, since the NTFS system is quite usual and its not fully compatible with linux (Kernels after 5.15 will solve this problem), if you are running a machine below that version, please check <`web_hosted`/Linux/#Create_your_own_mount_points>



## Media

#### Install FileRun

#### Install PhotoPrism

#### Qbittorrent


## IoT

### Internet Monitoring

### Home Automation

## Privacy

### Wireguard

### Whoogle 

### Pihole 

### Watchyourlan 

### Unbound 

## Management

### LeanTime


## Messaging

### Matrix Chat

<https://matrix.org/>

## Web Hosting

### Wordpress

Host your wordpress page

### Ghost

## Web Analytics

### Plausible

### Umami






[^1]: You can get one [here ](https://www.raspberrypi.com/products/)
[^2]: Check out other projects from [my main page](`r web_hosted`/JAlcocerT/projects/index.html)