---
title: "RPi A-Z Setup and Projects"
author: "JAT"
date: "Updated on: `r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    css: styles.css
    toc: true
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE} 
a = knitr::asis_output("\U2714")
```


```{r klippy, echo=FALSE, include=TRUE}
#It allows the clipboard button to be available in the html output
klippy::klippy()

#install.packages("remotes")
#remotes::install_github("rlesur/klippy")
```



# **RPi Setup**



The Raspberry Pi is a tiny and affordable computer, low power consumption (ARM based) that you can use to learn programming through fun, practical projects and also allow us to have our own server to run 24/7 tasks that don't require the expensive hardware of a PC. [^1]

It can run Linux distros like: Debian, OpenMediaVault or most commonly Raspbian OS.


All of the services/projects that we can make the RPi to run, can be easily ported to some cloud service, VPS and so on. So it serves as an entry point to learn also about that as well.

Due to the compatibility between raspbian and most debian based linux, most of the topic here will reference the guide on how to setup a general linux server, including an extra explanation here where some specifics apply to the RPi.

As of today, the total compatibility with linux would be on the following topics:

- [ ] RPi Firmware update
- [x] Schedule Crontab tasks
- [x] Setup fail2ban
- [x] Firewall setup (UFW)
- [x] Create custom aliases
- [x] Install GIT and sync your repos

With Docker containers, due to the nature of the ARM processors that the RPi includes, we might need as well some changes from an usual debian-based configuration. Total compatibility is manteined on:

- [X] Qbittorrent
- [ ] Nextcloud


Web version of the outputs generated by the codes posted on <https://github.com/reisikei/RPi>

Please feel free to copy, modify, distribute and suggest any further improvements on the codes below. [^2]


## RPi Firmware update

Check firmware version with :

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
  sudo rpi-eeprom-update
```
   
Option 1:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo apt update &&
sudo apt full-upgrade
```

Now restart Raspberry Pi by using:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo shutdown - r now
```
 
Option 2:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"} 
sudo apt update && sudo apt upgrade -y \
sudo apt install rpi-eeprom rpi-eeprom-images
```    
Install rpi-eeprom:  sudo apt install rpi-eeprom rpi-eeprom-images
Update the Firmware: sudo rpi-eeprom-update -a

##### **Last time tested on Sept 2021 `r a`**



## Schedule Crontab tasks

As we can expect, crontab is a common function on linux, so we can use [this guide](https://reisikei.github.io/Linux/#Schedule_Crontab_tasks) to make it run on our RPi.




## Setup fail2ban
 
 To setup fail2ban in the RPi, we simply have to follow the same steps as in any other [Linux distro](https://reisikei.github.io/Linux/#Setup_fail2ban).
 
 It is extremely recommendable to do it, specially if we are going to open any of our services to the internet, like hosting a web page with with wordpress.
 
 
 
## Firewall setup (UFW)
 
Another important security measure is to correctly setup our firewall.

Be sure to leave open only the ports that your services need and again, we can follow the same process as in the [guide for linux](https://reisikei.github.io/Linux/#Firewall_setup_(ufw)).

## Create custom aliases 
 
Lets edit this file:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
nano ~/.bash_aliases
```

Add this line to know the RPi's temperature by typing 'temp' on the terminal:
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
alias temp='/opt/vc/bin/vcgencmd measure_temp' ### TEMP RPi
```

Use this command to be able to use the new alias already in the current session
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
source ~/.bashrc
```

Other aliases that can be used indistinctely in any other linux distro, can be found [here](https://reisikei.github.io/Linux/#Create_custom_aliases)

##### **Last time tested on Sept 2021 `r a`**

## Install GIT and sync your repos
 
```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
 sudo apt install git &&
 git clone https://github.com/reisikei/RPi.git &&
 cd RPi &&
 git pull #to make sure its up to date (a cron task could be scheduled)
```

##### **Last time tested on Sept 2021 `r a`**




# **RPi Projects**

## TailScale VPN setup

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo apt-get install apt-transport-https &&
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/buster.gpg | sudo apt-key add - &&
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/buster.list | sudo tee /etc/apt/sources.list.d/tailscale.list &&
sudo apt-get update &&
sudo apt-get install tailscale &&
sudo tailscale up &&
tailscale ip -4 #get the ip 

#sudo tailscale logout
#sudo tailscale down
```
 
#To force all the traffic to go through the Rpi, Port forwarding is needed:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.conf &&
echo 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.conf &&
sudo sysctl -p /etc/sysctl.conf &&
sudo tailscale down
```

With this final command, the RPi will be an exit node:

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}
sudo tailscale up --advertise-exit-node
```

Remember to allow as admin in the tailscale network this machine as exit node as well. In review route settings -> use as exit node.

##### **Last time tested on Sept 2021 `r a`**


## Facial recognition

## Install Docker

Since raspberry OS is another linux distribution (Debian based), the Docker installation and containers listed in the following github page:
<https://reisikei.github.io/Linux/#Install_Docker> are completely functional on the RPi as it would be, for example in Ubuntu.

### Torrents within Docker

#### Qbittorrent

#### Transmission Telegram Bot

### Install Nextcloud

To install nextcloud in RPi, we need to include MariaDB in the installation (it supports ARM processors)

```{r, include=TRUE, eval=FALSE, class.source=".TheCode"}

docker

```

### Install a NAS (OMV)

### Install your own email server

<https://github.com/lukesmithxyz/emailwiz>

### Install your own messaging platform

<https://matrix.org/>

<https://xmpp.org/>

### Host your wordpress page



[^1]: You can get one [here ](https://www.amazon.es/Waveshare-Completely-Multi-Media-Capability-Networking/dp/B089DGSLZW/ref=sr_1_8?__mk_es_ES=%C3%85M%C3%85%C5%BD%C3%95%C3%91&dchild=1&keywords=raspberry%2Bpi%2B4&qid=1634023704&sr=8-8&th=1)
[^2]: Check out other projects from [my main page](https://reisikei.github.io/reisikei/)