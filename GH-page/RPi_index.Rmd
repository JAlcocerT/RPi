---
title: "RPi A-Z Setup and Projects"
author: "JAT"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    css: styles.css
    toc: true
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r clipboard, include=FALSE}

#```{r klippy, echo=FALSE, include=TRUE}
#It allow the clipboard button to be available in the html output
#klippy::klippy()


## install.packages("remotes")
#remotes::install_github("rlesur/klippy")
#```

```



# RPi Setup

Web version of the outputs generated by the codes posted on <https://github.com/reisikei/RPi>

Please feel free to copy, modify, distribute and suggest any further improvements on them.

## RPi Firmware update

Check firmware version with :

  ```javascript
  sudo rpi-eeprom-update
   ```
   
### OPTION 1:

 ```javascript
sudo apt update &&
sudo apt full-upgrade
```

Now restart Raspberry Pi by using:

 ```javascript 
sudo shutdown - r now
 ```
 
### OPTION 2:
``` 
sudo apt update && sudo apt upgrade -y \
sudo apt install rpi-eeprom rpi-eeprom-images
```    
Install rpi-eeprom:  sudo apt install rpi-eeprom rpi-eeprom-images
Update the Firmware: sudo rpi-eeprom-update -a

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```


## Schedule Crontab tasks

Open crontab:

```
crontab -e
```

Update it every midnight and every restart:

```
0 0 * * * sudo apt update && sudo apt upgrade
@reboot sudo apt update && sudo apt upgrade
```

If your script isn't executing, check the system log for cron events:
grep cron /var/log/syslog

If you'd wish to view your scheduled tasks without editing you can use the command:

```
crontab -l 
```

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```


## Setup fail2ban
 
 ```
 #fail2ban
sudo apt-get install -y \
apt-transport-https \
ca-certificates \
curl \
gnupg2 \
vim \
fail2ban \
ntfs-3g
```

#sudo nano /etc/fail2ban/jail.conf
```
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local && #copying it to edit
sudo nano /etc/fail2ban/jail.local
```

Add this to the file to ban for 24h if retry +3 times:

```
bantime = 86400
port    = ssh
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
```

```
sudo service fail2ban restart &&
sudo nano /var/log/fail2ban.log
 ```
 
 ```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```
 
 
 
 
## Firewall setup (ufw)
 
sudo ss -tupln #ports in use

```
sudo apt install ufw && #ufw
sudo ufw status &&
sudo ufw allow 22 && #allow ssh
sudo ufw enable &&
sudo ufw status &&
sudo ufw reload #restart it
```

sudo ufw allow 717 #example to allow conexion

Typical ports that are used: 22 for ssh, 443 for https, 80 for http

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```

## Create custom aliases 
 
Lets edit this file:

```
nano ~/.bash_aliases
```

Add this line to know the Rpi temperature by typing 'temp' on the terminal:
```
alias temp='/opt/vc/bin/vcgencmd measure_temp' ### TEMP RPi
```

Add this line to know your public ip address by typing myip on the terminal:
```
alias myip='curl ipinfo.io/ip' #public ip address
```
Use this command to be able to use the new alias already in the current session
```
source ~/.bashrc
```

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```

## Install GIT and sync your repos
 
 ```
 sudo apt install git &&
 git clone https://github.com/reisikei/RPi.git &&
 cd RPi &&
 git pull #to make sure its up to date (a cron task could be scheduled)
```

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```




# RPi Projects

## TailScale VPN setup

```
sudo apt-get install apt-transport-https &&
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/buster.gpg | sudo apt-key add - &&
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/buster.list | sudo tee /etc/apt/sources.list.d/tailscale.list &&
sudo apt-get update &&
sudo apt-get install tailscale &&
sudo tailscale up &&
tailscale ip -4 #get the ip 

#sudo tailscale logout
#sudo tailscale down
 ```
 
#To force all the traffic to go through the Rpi, Port forwarding is needed:

```
echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.conf &&
echo 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.conf &&
sudo sysctl -p /etc/sysctl.conf &&
sudo tailscale down
```

With this final command, the RPi will be an exit node:

```
sudo tailscale up --advertise-exit-node
sudo tailscale up --exit-node=<exit-node-ip>
```

```{r, echo=FALSE} 
knitr::asis_output("Last time tested on Sept 2021 \U2714")
```

## Install Docker

Since raspberry OS is another linux distribution (Debian based), the Docker installation and containers listed in the following github page:
<https://reisikei.github.io/Linux/#Install_Docker> are completely functional on the RPi as it would be, for example in Ubuntu.

### Torrents within Docker

#### Qbittorrent

#### Transmission Telegram Bot

## Install Nextcloud

## Install a NAS (OMV)

## Install your own email server

<https://github.com/lukesmithxyz/emailwiz>

## Install your own messaging platform

<https://matrix.org/>

<https://xmpp.org/>